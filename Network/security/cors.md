# CORS - Cross-Origin Resource Sharing - Совместное использование ресурсов из разных источников

https://developer.mozilla.org/ru/docs/Web/HTTP/CORS
https://habr.com/ru/companies/macloud/articles/553826/
https://doka-guide.vercel.app/tools/cors/

Это механизм браузера, который позволяет определить список ресурсов, к которым страница может получить доступ. Он `необходим для обеспечения безопасности и защиты пользователей от злоумышленников при использовании HTTP протокола`. 

По умолчанию, сайты могут запрашивать ресурсы только со своего **origin**. Такое ограничение называется **Same-Origin Policy**. CORS расширяет Same-Origin Policy, позволяя получать доступ к ресурсам с разных доменов.

**origin** - это комбинация протокола, домена и порта.
Например, google.com - это домен, а https://google.com - origin.

## Как работает

1. Пользователь открывает страницу сайта google.com;
2. Страница отправляет запрос к стороннему источнику ya.ru
3. Браузер сравнивает origin и понимает, что api.example.com - сторонний origin для нашего сайта, из-за чего блокирует запрос;

Правильная настройка CORS помогает решить возможные проблемы с доступом к другим ресурсам и обеспечить безопасность веб-приложений.

## Настройка

Настройка CORS со стороны сервера:

- **Access-Control-Allow-Origin** - указывает на origin, откуда на сервер разрешены запросы.
- **Access-Control-Allow-Methods** - указывает, какие HTTP-методы разрешены для запросов на сервер.
- **Access-Control-Allow-Headers** - определяет, какие заголовки могут быть использованы в ответе от сервера.
- **Access-Control-Allow-Credentials** - указывает, разрешено ли отправлять cookie и авторизационные данные вместе с запросом на сервер.
- **Access-Control-Max-Age** - определяет максимальное время, в течение которого должны кэшироваться предыдущие ответы на запросы предварительной проверки CORS.
- **Access-Control-Expose-Headers** - определяет список заголовков, которые могут быть доступны на клиентской стороне.

Настройка со стороны браузера:

- **Origin** - указывает на комбинацию домена, порта и протокола, откуда на сервер поступает запрос.

Заголовки для настройки предварительных запросов:

- **Access-Control-Request-Method** - определяет метод запроса, который будет использоваться в основном запросе.
- **Access-Control-Request-Headers** - используется для указания заголовков, которые будут использоваться в основном запросе.

## Предварительные запросы
это дополнительный HTTP запрос, который отправляется браузером перед основным запросом.

Когда страница запрашивает данные с другого origin, браузер отправляет предварительный запрос **OPTIONS** на сервер, чтобы узнать, разрешены ли такие запросы. При повторном запросе на тот же **origin**, запрос OPTIONS может и не отправляться, а все данные будут получены из кеша.